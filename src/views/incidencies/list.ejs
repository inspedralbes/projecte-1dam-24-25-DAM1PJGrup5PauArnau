<%- include('../partials/header', { title: 'Llista d\'Incidències' }) %>

<h1 class="mb-4">Llista d'Incidències</h1>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>Descripció</th>
      <th>Departament</th>
      <th>Prioritat</th>
      <th>Tècnic</th>
      <th>Accions</th>
    </tr>
  </thead>
  <tbody>
    <% incidencies.forEach(inc => { %>
      <tr>
        <form action="/incidencies/<%= inc.id %>/update" method="POST">
          <td><%= inc.descripcio %></td>
          <td><%= inc.Departament ? inc.Departament.nom : 'Sense departament' %></td>

          <!-- PRIORITAT editable -->
          <td>
            <select name="prioritat" class="form-select form-select-sm">
              <option value="Baixa" <%= inc.prioritat === 'Baixa' ? 'selected' : '' %>>Baixa</option>
              <option value="Mitjana" <%= inc.prioritat === 'Mitjana' ? 'selected' : '' %>>Mitjana</option>
              <option value="Alta" <%= inc.prioritat === 'Alta' ? 'selected' : '' %>>Alta</option>
            </select>
          </td>

          <!-- TÈCNIC editable -->
          <td>
            <select name="tecnicId" class="form-select form-select-sm">
              <option value="">-- Sense tècnic --</option>
              <% tecnics.forEach(tecnic => { %>
                <option value="<%= tecnic.id %>" <%= inc.Tecnic && inc.Tecnic.id === tecnic.id ? 'selected' : '' %>>
                  <%= tecnic.nom %>
                </option>
              <% }) %>
            </select>
          </td>

          <!-- Botó guardar -->
          <td>
            <button type="submit" class="btn btn-sm btn-success">Guardar</button>
          </td>
        </form>
      </tr>
    <% }) %>
  </tbody>
</table>
<ul class="list-group">
  <% incidencies.forEach(inc => { %>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      
      <span>
        <strong>Descripció:</strong> <%= inc.descripcio %><br>
        <small><strong>Prioritat:</strong> <%= inc.prioritat %></small><br>
        <small><strong>Departament:</strong> <%= inc.Departament  ? inc.Departament.nom : 'Sense departament' %></small>      </span>
        <small><strong>Estat:</strong> </small>
      <span>
        <a href="/incidencies/<%= inc.id %>/edit" class="btn btn-warning">Editar</a>
        <a href="/incidencies/<%= inc.id %>/delete" class="btn btn-danger">Eliminar</a>
      </span>
    </li>
  <% }) %>
</ul>

<%- include('../partials/footer') %>
